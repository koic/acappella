#!/usr/bin/env ruby

lib_path = File.expand_path('../../lib', __FILE__)
$:.unshift(lib_path)

require 'acappella'
require 'uri'

options = ACappella::OptionParser.parse(ARGV)

uri = URI.parse("druby://#{options[:host]}:#{options[:port]}")

server = ACappella::Server.new(uri.to_s)

puts 'Ctrl-C to shutdown server'

Signal.trap(:INT) do
  puts; puts('Stopping ...')

  server.stop

  puts('Exiting ...'); exit(false)
end

server.start
